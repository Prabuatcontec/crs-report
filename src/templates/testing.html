<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Contec Testing</title>
</head>
<style>
  body {
    
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    background-color: #f1f1f1;
    padding-left: 10px;
    padding-right: 10px;
  }
  .container {
    display: flex;
    font-family: arial;
    font-size: 24px;
    margin: 15px;
    width: 11%;
    height:  10%;
    /*outline: dashed 1px black;
     Setup */
    position: relative;
    float:left;
  }
  
  .child {
    width: 50%;
    height: 50%; 
    /* Center vertically and horizontally */
    position: absolute;
    top: 50%;
    left: 20%;
    margin: -25px 0 0 -25px; /* Apply negative top and left margins to truly center the element */
  }
  .counts {
    width : 100%;
    
  }
  .white {

  }
  .counts1 {
    width : 100%;
    
  }
  .fn-inner {
    font-size: 70px;
  }

</style>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">

<body> 
    <div class="bg-primary p-2 text-light">Testing Today</div>
    <div class="container">
      <div class="row g-2 counts" id="counts" >
         
      </div>
    </div>
    <span id="load_data"></span>
    
    <div class="container">
      <div class="row" id="counts1" >
        
        <div class="col-12 col-md-6 order-2 order-md-1" id="g1"> 
          <canvas id="myChart"></canvas> 
        </div>
        <div class="col-12 col-md-6 order-2 order-md-1" id="g2">
          <canvas id="myChart1"></canvas> 
          </div>
      </div>
    </div>
 
    <input type="hidden" value="{{wh}}" id="wh" class="wh" />
     
</body>
</html>

<script> 
    $(function() {

        randomIntFromInterval = function(min, max) { // min and max included 
            return Math.floor(Math.random() * (max - min + 1) + min)
          }
       
        getShippingCount = function(e) {
              fnt = ['text-primary','text-success','text-danger', 'text-warning' ,'text-primary','text-danger']
              fnt_bg = ['bg-primary','bg-success', 'bg-warning' ,'bg-primary','bg-danger']
              bclr = [
              'rgba(255, 99, 132, 0.2)',
              'rgba(255, 159, 64, 0.2)',
              'rgba(255, 205, 86, 0.2)',
              'rgba(75, 192, 192, 0.2)',
              'rgba(54, 162, 235, 0.2)',
              'rgba(153, 102, 255, 0.2)',
              'rgba(201, 203, 207, 0.2)',
              'rgba(255, 205, 86, 0.2)',
              'rgba(75, 192, 192, 0.2)',
              'rgba(54, 162, 235, 0.2)',
              'rgba(75, 192, 192, 0.2)',
              'rgba(54, 162, 235, 0.2)'
            ]
            bclrbr = [
            'rgb(255, 99, 132)',
            'rgb(255, 159, 64)',
            'rgb(255, 205, 86)',
            'rgb(75, 192, 192)',
            'rgb(54, 162, 235)',
            'rgb(153, 102, 255)',
            'rgb(201, 203, 207)',
            'rgb(54, 162, 235)',
            'rgb(153, 102, 255)',
            'rgb(201, 203, 207)',
            'rgb(153, 102, 255)',
            'rgb(201, 203, 207)'
          ]
            $.ajax({
                type: "GET",
                url: "wh-testing/"+$('.wh').val(),
                data: {},
                contentType: "application/json",
                dataType: "json",
                success: function(response) { 
                  len_ar = ['MTF','MTP','STF','STP','Repeated','Single','Total']
                  
                  today = response['today']
                  var d = ''
                  var labels = []
                  var lo = {}
                  data_set = []
                  bclr_ar = []
                  bclrbr_ar = []
                  for (let i = 0; i < len_ar.length; i++) {
                     
                    labels.push(len_ar[i])
                     
                    data_set.push(today[len_ar[i]])
                    bclrbr_ar.push(bclr[randomIntFromInterval(0, 10)])
                    bclr_ar.push(bclrbr[randomIntFromInterval(0, 10)])
                     d = d + '<div class="col-16 col-md-2 order-2 order-md-1"> '+
                      '<div class="bg-light text-center p-2 text-dark">'+len_ar[i]+'</br><span class="'+fnt[randomIntFromInterval(0, 5)]+' fn-inner">'+today[len_ar[i]]+'<span></div>'+
                    '</div>' 
                  }
                  
                  document.getElementById("counts").innerHTML=d;

                  testtype = response['testtype']
                  testtypes = response['testtypes']
                  var gm = ''
                  for (let s = 0; s < testtypes.length; s++) {

                    gm = gm + '<div style="clear:both;"></div>'+
                    '<div class="'+fnt_bg[randomIntFromInterval(0, 4)]+' p-2">'+testtypes[s]+'</div>'+
                    '<div style="clear:both;"></div>'+
                    '<div class="container">'+
                    '<div class="row g-2 counts1" id="counts1'+s+'" >'+
                    '</div>'+
                    '</div>'+
                    '<div style="clear:both;"></div>'
                    
                    } 
                document.getElementById("load_data").innerHTML = gm
                for (let s = 0; s < testtypes.length; s++) {
                    today = testtype[testtypes[s]]
                   d = '' 
                  var lo = {}
                  for (let i = 0; i < len_ar.length; i++) { 
                     d = d + '<div class="col-16 col-md-2 order-2 order-md-1"> '+
                      '<div class="bg-light text-center p-2 text-dark">'+len_ar[i]+'</br><span class="'+fnt[randomIntFromInterval(0, 5)]+' fn-inner">'+today[len_ar[i]]+'<span></div>'+
                    '</div>' 
                  }
                  document.getElementById("counts1"+s).innerHTML = d 
                }

                
                  
                  
                  
                  if(e==1){
                  const ctx = document.getElementById('myChart');
                   
                  new Chart(ctx, {
                    type: 'bar',
                    data: {
                      labels: labels,
                      datasets: [{"label": "Today", "data":data_set, borderWidth: 1, backgroundColor:bclr_ar, borderColor:bclr_ar }],
                      
                    },
                    options: {
                      scales: {
                        y: {
                          beginAtZero: true
                        }
                      },
                      tooltips: {
                          enabled: true
                      },
                      hover: {
                          animationDuration: 1
                      },
                    }
                  });
                } 

                },
            });

        };  
        

        window.setTimeout( function() {
          getShippingCount(0);
        }, 100000);

        getShippingCount(1);
        window.setTimeout( function() {
          window.location.reload();
        }, 600000);
}.call(this)); 
</script>